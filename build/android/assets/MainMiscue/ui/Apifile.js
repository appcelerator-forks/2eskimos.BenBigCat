var r_loadingScreen=require('/MainMiscue/ui/loadingScreen'),r_miscue=require('/MainMiscue/miscue'),r_LoginPage=require('/MainMiscue/ui/LoginPage'),r_HomeScreen=require('/MainMiscue/ui/HomeScreen'),r_miscueMenuPage=require('/MainMiscue/ui/miscueMenuPage'),r_sessionBookPage=require('/MainMiscue/ui/sessionBookPage');function createApi(url,strng,text1,text2,flag,modal,apiCount,menuItemKey,button_Id,audioFileName,fontcolour,backcolour,pagefontfamily,isPageName,tableView,sessionCount,fileName,loopEnds,submitSession){var xmldata,loginReq=Ti.Network.createHTTPClient();if(url=Ti.App.Properties.getString('apiURL'),'null'!=audioFileName&&'android'!=Ti.Platform.osname&&(testFile=Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,audioFileName),!1==testFile.exists()&&(audioFileName='null')),Ti.API.info('---------- BEN - audioFileName = '+audioFileName),7==flag){if(Ti.API.info('---------- BEN - flag7'),'null'!=audioFileName){'android'==Ti.Platform.osname?(Ti.API.info('---------- BEN - Generaing the directory where I hope to find the audio file...'),audioFileName=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,audioFileName),Ti.API.info('---------- BEN - The directory is = '+audioFileName.nativePath)):audioFileName=Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,audioFileName),Ti.API.info('---------- BEN - Now an XML request is made...');var var1='requestXML',name='myFile',filename='b.b64',boundary='-------------------------301503177511666',header='--'+boundary+'\r\nContent-Disposition: form-data;  name="requestXML"\r\n\r\n'+strng+'\r\n\r\n';header+='--'+boundary+'\r\n',header+='Content-Disposition: form-data; name="'+name+'";',header+=' filename="'+filename+'"\r\n',header+='Content-Type: application/octet-stream\r\n\r\n';var content=audioFileName.read();content=Ti.Utils.base64encode(content);var fullContent=header+content+'\r\n--'+boundary;loginReq.open('POST',url),loginReq.setRequestHeader('enctype','multipart/form-data'),loginReq.setRequestHeader('Content-type','multipart/form-data;boundary="'+boundary+'"'),loginReq.setRequestHeader('Content-Length',fullContent.length),loginReq.send(fullContent)}else{loginReq.open('POST',url),Ti.API.log('Req url of save session:: ',url);var param={requestXML:strng};Ti.API.log('Req param at save session:: ',strng),loginReq.send(param)}}else if(5!=flag){loginReq.open('POST',url);var param={requestXML:strng};loginReq.send(param),Ti.API.log('Api request param is :: ',param)}else if(Ti.API.info('---------- BEN - flag 5'),'null'!=fileName){if('android'!=Ti.Platform.osname)fileName=Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,fileName);else{var audioDir=Titanium.Filesystem.getFile(Titanium.Filesystem.externalStorageDirectory,'Miscue');fileName=Ti.Filesystem.getFile(audioDir.resolve(),fileName)}var name='myFile',filename='b.b64',boundary='-------------------------301503177511666',header='--'+boundary+'\r\nContent-Disposition: form-data;  name="requestXML"\r\n\r\n'+strng+'\r\n\r\n';header+='--'+boundary+'\r\n',header+='Content-Disposition: form-data; name="'+name+'";',header+=' filename="'+filename+'"\r\n',header+='Content-Type: application/octet-stream\r\n\r\n';var content=fileName.read();content=Ti.Utils.base64encode(content);var fullContent=header+content+'\r\n--'+boundary;loginReq.open('POST',url),loginReq.setRequestHeader('enctype','multipart/form-data'),loginReq.setRequestHeader('Content-type','multipart/form-data;boundary="'+boundary+'"'),loginReq.setRequestHeader('Content-Length',fullContent.length),loginReq.send(fullContent)}else{loginReq.open('POST',url);var param={requestXML:strng};loginReq.send(param)}Ti.API.info('---------- BEN - Should skip to here...'),loginReq.onload=function(){xmldata=this.responseText,'ESKIMO'==Ti.App.Properties.getString('currentAppID')&&(xmldata=xmldata.replace(/COLV1/g,'ESKV1')),2===flag?(Ti.API.log('XML data for flag==2 is :: ',xmldata),r_miscueMenuPage.getGroupLearner(xmldata,text1,text2,apiCount,modal)):3==flag?(Ti.API.log('XML data for flag==3 is :: ',xmldata),r_LoginPage.getLanguage(xmldata,text1)):4==flag?(Ti.API.log('XML data for flag==4 is :: ',xmldata),r_miscueMenuPage.createBooksTest(xmldata,text1,text2,modal,apiCount,menuItemKey,button_Id)):5==flag?(Ti.API.log('XML data for flag==5 is :: ',xmldata),r_sessionBookPage.createSavePendingMiscueSessionToServer(xmldata,text2,menuItemKey,modal,apiCount,sessionCount,button_Id,audioFileName,fontcolour,backcolour,pagefontfamily,isPageName,tableView,text1,loopEnds,submitSession)):7==flag?(Ti.API.log('XML data for flag==7 is :: ',xmldata),r_sessionBookPage.SaveMiscueSessionToServer(xmldata,text2,apiCount,modal,text1,menuItemKey,button_Id)):1==flag&&(Ti.API.log('XML data for flag==1 is :: ',xmldata),r_LoginPage.callback(xmldata,text1,text2,apiCount,modal))},loginReq.onerror=function(e){5==flag&&(modal.touchEnabled=!0);var labelArray=[];labelArray.title=['Alert','Alert'],labelArray.message=['network_Not_Found. ','Network not found. '+url],labelArray[1]=['Ok','OK'];var dialog=r_HomeScreen.createLocalizedAlertDialog(labelArray,text1);if(dialog.show(),2==flag&&dialog.addEventListener('click',function(e){if(0==e.index){var miscuewindow=r_miscue.tt.ui.createmiscueMenuPage(text1,text2,apiCount);miscuewindow.open(),modal.close()}}),4==flag&&dialog.addEventListener('click',function(e){if(0==e.index){var miscuewindow=r_miscue.tt.ui.createmiscueMenuPage(text1,text2,apiCount);miscuewindow.open(),modal.close()}}),1==flag){var db=Titanium.Database.open('Miscue'),loginIdRow=db.execute('SELECT userid FROM Login WHERE username = ?',text1);if(0<loginIdRow.rowCount){var loginUserId=loginIdRow.fieldByName('userid');loginIdRow.close();var homescreencheckrow=db.execute('SELECT * FROM UserMenuItem WHERE userId=?',loginUserId);if(0<homescreencheckrow.rowCount){homescreencheckrow.close(),db.close();var homeScreenWin=r_miscue.tt.ui.createHomeScreen(text1);homeScreenWin.open(),modal.close()}}modal.touchEnabled=!0}if(7==flag)if('search'==menuItemKey){var menuItemKeys='miscueanalysis',searchSession=r_miscue.tt.ui.createsearchSession(text1,text2,button_Id,menuItemKeys);searchSession.open(),modal.close()}else{var menuItemKeys='miscueanalysis',miscuewindow=r_miscue.tt.ui.createmiscueMenuPage(text1,button_Id,menuItemKeys);miscuewindow.open(),modal.close()}r_loadingScreen.hideActivity()},loginReq.setTimeout(4e4)}exports.createApi=createApi;