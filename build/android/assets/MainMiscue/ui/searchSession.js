var r_miscue=require('/MainMiscue/miscue.js'),r_loadingScreen=require('/MainMiscue/ui/loadingScreen'),r_HomeScreen=require('/MainMiscue/ui/HomeScreen'),r_styles=require('/MainMiscue/ui/styles'),r_sessionBookPage=require('/MainMiscue/ui/sessionBookPage'),r_Apifile=require('/MainMiscue/ui/Apifile');(function(){r_miscue.tt.ui.createsearchSession=function(userName,userId,token,menuItemKey){function orientionChangeMode(e){return;var screenRes=r_loadingScreen.backgroundImageHeightWidthPxToDp();screenBackgroundImage[1].width=screenRes[0],Ti.Platform.displayCaps.platformWidth>Ti.Platform.displayCaps.platformHeight?(screenBackgroundImage[1].height=screenRes[1],Ti.API.info('or change landscape'+screenBackgroundImage[1].height),backView.height=70,backView.width=135):('ipad'==osname||'iphone'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight-Titanium.Platform.displayCaps.platformHeight/2.5,Ti.API.info('or change portrair ipad and iPhone'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),Ti.API.info('or change portrair android'+screenBackgroundImage[1].height)),Inch>=InchValue&&('iphone'==osname||'ipad'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight,Ti.API.info('or change inch > value portrair iphone or ipad'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/100),Ti.API.info('or change inch > value portrair android'+screenBackgroundImage[1].height)),backView&&(backView.height=80,backView.width=145)));var portraitval=r_loadingScreen.dptopixel(),lwidth=Ti.Platform.displayCaps.platformWidth,dpVal=115,pxlvalsearchsession=r_loadingScreen.dptopixel(dpVal)}var now=new Date;Ti.API.info('serach session');var labelName,deleteLabelName,minutes=now.getMinutes(),sec=now.getSeconds(),osname=Ti.Platform.osname,pWidth=Ti.Platform.displayCaps.platformWidth,db=Titanium.Database.open('Miscue'),homerow=db.execute('SELECT * FROM UserSetting where loginId =?',userId),schoolnames=homerow.fieldByName('schoolName'),backpage=homerow.fieldByName('backPage'),backcolour=homerow.fieldByName('backgroundColor'),fontcolour=homerow.fieldByName('fontColor'),pagefontfamily=homerow.fieldByName('charFont'),browseWindowBackgroundImage=homerow.fieldByName('selectionPagebackgroundURL'),dec=Ti.Utils.base64decode(schoolnames),backView=r_loadingScreen.createBackButton(fontcolour,homerow.fieldByName('backImageURL'));homerow.close(),homerow=null;var localizedAlertLabelnamerow=db.execute('SELECT * FROM Language WHERE userId =? AND labelId IN (\'search_Submit_Pending_Session\',\'Delete\')',userName);if(0<localizedAlertLabelnamerow.rowCount)for(;localizedAlertLabelnamerow.isValidRow();){var labelId=localizedAlertLabelnamerow.fieldByName('labelId'),LocalizedLabelName=localizedAlertLabelnamerow.fieldByName('label');'search_Submit_Pending_Session'==labelId&&(labelName=LocalizedLabelName),'Delete'==labelId&&(deleteLabelName=LocalizedLabelName),localizedAlertLabelnamerow.next()}else labelName='Submit pending session',deleteLabelName='Delete';db.close(),db=null;var iOS7=r_loadingScreen.isiOS7Plus(),miscueSearchWin=Ti.UI.createWindow({fullscreen:!1,navBarHidden:!0,tabBarHidden:!0,backgroundColor:'white'});7<=iOS7&&(miscueSearchWin.top='20dp');var Inch=r_loadingScreen.screenInch(),screenBackgroundImage=r_loadingScreen.mainBackgroundImage(browseWindowBackgroundImage);miscueSearchWin.add(screenBackgroundImage[0]);var screenRes=r_loadingScreen.backgroundImageHeightWidthPxToDp();screenBackgroundImage[1].height='iphone'==osname||'ipad'==osname?Titanium.Platform.displayCaps.platformHeight:Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),screenBackgroundImage[1].width=screenRes[0],Ti.Platform.displayCaps.platformWidth>Ti.Platform.displayCaps.platformHeight?(Inch>=InchValue&&(backView.height=70,backView.width=135),screenBackgroundImage[1].height=screenRes[1],Ti.API.info('Initial height for landscape '+screenBackgroundImage[1].height)):('ipad'==osname||'iphone'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight-Titanium.Platform.displayCaps.platformHeight/2.5,Ti.API.info('Initial height for portrait ipad and iPhone '+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),Ti.API.info('Initial height for portrait android'+screenBackgroundImage[1].height)),Inch>=InchValue&&('iphone'==osname||'ipad'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight,Ti.API.info('Inch Height for iphone or ipad(portrait)'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/100),Ti.API.info('Inch Height for android(portrait)'+screenBackgroundImage[1].height)),backView.height=80,backView.width=145)),'iphone'==osname&&(backView.height=48,backView.width=78),Inch<InchValue&&'android'==osname?(backView.height=50,backView.width=80,miscueSearchWin.orientationModes=[Titanium.UI.PORTRAIT]):'android'==osname&&(miscueSearchWin.orientationModes=[Titanium.UI.PORTRAIT]);var top=r_loadingScreen.titleLabeltop(),iOS7=r_loadingScreen.isiOS7Plus(),webLabelName=Ti.App.Properties.getString('readingResultsMessage'),WebLabel=Ti.UI.createLabel({objName:'weblabel',verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,visible:!0,top:'12%',text:webLabelName,height:'35dp',width:'90%',textAlign:'center',borderWidth:2,borderRadius:10,font:{fontSize:'12dp',fontWeight:'bold'},borderColor:'black',color:'white',backgroundColor:'#88609b'});WebLabel.addEventListener('click',function(e){Titanium.Platform.openURL('http//www.bigcatassessment.com')}),miscueSearchWin.add(backView),backView.addEventListener('click',function(e){miscueSearchWin.remove(backView),miscueSearchWin.remove(PendingSessionButton),miscueSearchWin.remove(searchTextField),miscueSearchWin.remove(searchImageButton),miscueSearchWin.remove(screenBackgroundImage[0]),screenBackgroundImage[0]=null,5<miscueSearchWin.children.length&&miscueSearchWin.remove(tableView);var refcheck=2,wind=r_miscue.tt.ui.createmiscueMenuPage(userName,token,menuItemKey,userId);wind.open(),miscueSearchWin.close(),backView=null,PendingSessionButton=null,searchTextField=null,searchImageButton=null,miscueSearchWin=null}),'android'==Ti.Platform.osname&&miscueSearchWin.addEventListener('android:back',function(){miscueSearchWin.remove(backView),miscueSearchWin.remove(PendingSessionButton),miscueSearchWin.remove(searchTextField),miscueSearchWin.remove(searchImageButton),miscueSearchWin.remove(searchTextField),miscueSearchWin.remove(searchImageButton),miscueSearchWin.remove(screenBackgroundImage[0]),screenBackgroundImage[0]=null,5<miscueSearchWin.children.length&&miscueSearchWin.remove(tableView);var refcheck=2,wind=r_miscue.tt.ui.createmiscueMenuPage(userName,token,menuItemKey,userId);wind.open(),miscueSearchWin.close(),backView=null,PendingSessionButton=null,searchTextField=null,searchImageButton=null,miscueSearchWin=null});var deleteLabel;Ti.Network.online,5==miscueSearchWin.children.length&&miscueSearchWin.remove(tableView);var pending_Button_Top,tableView_top,maxInch=r_loadingScreen.screenInch();Inch>=InchValue?(pending_Button_Top='110dp',tableView_top='150dp'):(pending_Button_Top='85dp',tableView_top='130dp','ipad'==osname&&(pending_Button_Top='120dp',tableView_top='165dp'));var tableView=Ti.UI.createTableView({top:tableView_top,minRowHeight:70,selectionStyle:'NONE',separatorColor:'transparent',backgroundColor:'transparent',objName:'table'});if('android'!=Ti.Platform.osname){var footerView=Ti.UI.createView({height:0});tableView.footerView=footerView,tableView.footerTitle=''}var PendingSessionButton=Ti.UI.createLabel({text:labelName,right:10,labelid:'search_Submit_Pending_Session',textAlign:'center',backgroundColor:'transparent',top:pending_Button_Top,width:'200dp',color:fontcolour,borderWidth:2,borderRadius:10,borderColor:'#888',font:{fontSize:'16dp',fontWeight:'bold',fontFamily:pagefontfamily},height:'40dp'}),db=Titanium.Database.open('Miscue'),miscueSavePendingSessionToServerRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND  (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,'null');0==miscueSavePendingSessionToServerRow.rowCount&&(PendingSessionButton.visible=!1),miscueSavePendingSessionToServerRow.close(),miscueSavePendingSessionToServerRow=null,db.close(),db=null,miscueSearchWin.add(PendingSessionButton),miscueSearchWin.addEventListener('close',function(e){Ti.Gesture.removeEventListener('orientationchange',orientionChangeMode)});var isSumbitionInProgress='false';PendingSessionButton.addEventListener('click',function(e){if(Ti.Network.online){if('false'==isSumbitionInProgress){isSumbitionInProgress='true';var db=Titanium.Database.open('Miscue'),miscueSavePendingSessionToServerRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND  (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,'null'),interval=4e3*miscueSavePendingSessionToServerRow.rowCount;if(0<miscueSavePendingSessionToServerRow.rowCount){var pendingSessionRowCount=miscueSavePendingSessionToServerRow.rowCount;db.close();var isPageName='searchSession';miscueSearchWin.touchEnabled=!1;var labelArray=[];labelArray.message=['loading_Indicator','Please wait..'],r_loadingScreen.showActivity(labelArray.message,userName),Ti.App.Properties.setString('isSearchImageButtonIsClicked','false'),searchTextField.value='',createSubmitPendingSessionToServer(userId,token,miscueSearchWin,userName,menuItemKey,fontcolour,backcolour,pagefontfamily,isPageName,tableView,PendingSessionButton),isSumbitionInProgress='false'}else{isSumbitionInProgress='false',db.close();var labelArray=[];labelArray.title=['Alert','Alert'],labelArray.message=['no_Pending_Sessions','User has not created any sessions'],labelArray[1]=['Ok','OK'];var dialog=r_HomeScreen.createLocalizedAlertDialog(labelArray,userName);dialog.show()}}else return;}else if('false'==isSumbitionInProgress){isSumbitionInProgress='true';var labelArray=[];labelArray.message=['no_Internet_Connection','No internet connection'],r_HomeScreen.createLocalizedShowToastMessage(labelArray.message,userName),isSumbitionInProgress='false'}});var searchTextField=Ti.UI.createTextField({hintText:'learner name',color:'black',font:{fontSize:Inch<InchValue?'12dp':'18dp'},borderColor:'#aaa',top:'3%',height:Inch>=InchValue?'40dp':'35dp',width:'26%',right:'10%',backgroundColor:'white',paddingLeft:3});searchTextField.blur(),'android'==osname&&miscueSearchWin.addEventListener('focus',function(e){Ti.UI.Android.hideSoftKeyboard()});var searchImageButton=Ti.UI.createImageView({top:'3%',image:'/images/phase5/LEARNERSEARCH.png',right:'2.3%',height:'35dp',width:'7%'});return Inch>=InchValue&&(searchImageButton.height='42dp',searchImageButton.width='6%'),miscueSearchWin.add(searchImageButton),miscueSearchWin.add(searchTextField),Ti.App.Properties.setString('isSearchImageButtonIsClicked','false'),createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily),searchImageButton.addEventListener('click',function(e){if(''!=searchTextField.value){var db=Titanium.Database.open('Miscue'),searchSessionResult=db.execute('SELECT  * FROM MiscueSession M, Learner L WHERE M.userId = ? AND M.sessionStatus != ? AND M.learnerGuid = L.learnerGuid AND L.learnerName LIKE \'%'+searchTextField.value+'%\'',userId,'DELETED');if(0<searchSessionResult.rowCount)searchSessionResult.close(),db.close(),Ti.App.Properties.setString('isSearchImageButtonIsClicked','true'),searchTextField.blur(),'android'==osname&&miscueSearchWin.addEventListener('focus',function(e){Ti.UI.Android.hideSoftKeyboard()}),createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextField.value);else{searchSessionResult.close(),db.close();var SearchResultArray=[];SearchResultArray.title=['Alert','Alert'],SearchResultArray.message=['no_Sessions','This learner has not created any session'],SearchResultArray[1]=['Ok','OK'];var dialog=r_HomeScreen.createLocalizedAlertDialog(SearchResultArray,userName);dialog.show()}searchSessionResult=null,db=null}else{var SearchTextFieldEmptyArray=[];SearchTextFieldEmptyArray.title=['Alert','Alert'],SearchTextFieldEmptyArray.message=['empty_search_textField','Enter learner name'],SearchTextFieldEmptyArray[1]=['Ok','OK'];var dialog=r_HomeScreen.createLocalizedAlertDialog(SearchTextFieldEmptyArray,userName);dialog.show()}}),searchTextField.addEventListener('change',function(e){''==searchTextField.value&&(Ti.App.Properties.setString('isSearchImageButtonIsClicked','false'),createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily))}),Ti.Gesture.addEventListener('orientationchange',orientionChangeMode),'COLLINS'==Ti.App.Properties.getString('currentAppID')&&miscueSearchWin.add(WebLabel),miscueSearchWin}})();function createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextFieldValue){var marginViewWidth,deleteLabelName,currentVisibleDeleteView='NOT-DEFINED',osname=Ti.Platform.osname,top=r_loadingScreen.titleLabeltop(),Inch=r_loadingScreen.screenInch(),lWidth=Ti.Platform.displayCaps.platformWidth,lHeight=Ti.Platform.displayCaps.platformHeight,db=Titanium.Database.open('Miscue'),localizedAlertLabelnamerow=db.execute('SELECT * FROM Language WHERE userId =? AND labelId IN (\'Delete\')',userName);if(0<localizedAlertLabelnamerow.rowCount){var labelId=localizedAlertLabelnamerow.fieldByName('labelId'),LocalizedLabelName=localizedAlertLabelnamerow.fieldByName('label');'Delete'==labelId&&(deleteLabelName=LocalizedLabelName)}else deleteLabelName='Delete';db.close(),marginViewWidth='android'==osname?Titanium.Platform.displayCaps.platformWidth*(Titanium.Platform.displayCaps.dpi/160)/3+15+'dp':Titanium.Platform.displayCaps.platformWidth*(Titanium.Platform.displayCaps.dpi/163)/3+15+'dp';var sessionguid,section=[],labelArray=[];labelArray.title=['Alert','Alert'],labelArray.message=['search_Pending_Session_Delete','This session is not saved, anyway you want to delete?'],labelArray[1]=['Delete','Delete'],labelArray[2]=['Cancel','Cancel'];var dialog=r_HomeScreen.createLocalizedAlertDialog(labelArray,userName),archiveLabelArray=[];archiveLabelArray.title=['Alert','Alert'],archiveLabelArray.message=['archive_session','After archiving, this session will only be available on the web suite. Do you want to continue?'],archiveLabelArray[1]=['Archive','Archive'],archiveLabelArray[2]=['Cancel','Cancel'];var searchMiscueSessionRow,archiveDialog=r_HomeScreen.createLocalizedAlertDialog(archiveLabelArray,userName),tableviewData=[],maxInches=r_loadingScreen.screenInch(),db=Titanium.Database.open('Miscue');if(searchMiscueSessionRow='true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?db.execute('SELECT DISTINCT M.createdDate FROM MiscueSession M, Learner L WHERE M.userId = ? AND M.sessionStatus != ? AND M.learnerGuid = L.learnerGuid AND L.learnerName LIKE \'%'+searchTextFieldValue+'%\'ORDER BY createdDate',userId,'DELETED'):db.execute('SELECT DISTINCT createdDate FROM MiscueSession WHERE userId = ? AND sessionStatus != ? ORDER BY createdDate',userId,'DELETED'),0<searchMiscueSessionRow.rowCount){function convertToDisplayFormat(convertDate){var sessionEditedDate=new Date(convertDate),month=[];month[0]='January',month[1]='February',month[2]='March',month[3]='April',month[4]='May',month[5]='June',month[6]='July',month[7]='Aug',month[8]='Sept',month[9]='Oct',month[10]='Nov',month[11]='Dec';var getYear=sessionEditedDate.getFullYear();return getYear=getYear.toString(),sessionEditedDate.getDate()+'-'+month[sessionEditedDate.getMonth()]+'-'+getYear.substr(2,3)}function createCustomeTableViewRowForBiggerScreen(rowData,userId,sectionVal){var row_height,bookImageViewleft,dateLabelLeft,noteLabelTop,date_left,learnerLabelTop;row_height='185dp',learnerLabelTop='115dp',noteLabelTop='155dp';var tableSectionView=Ti.UI.createView({backgroundColor:'transparent',height:'55dp'}),tableSectionLabel=Ti.UI.createLabel({font:{fontFamily:pagefontfamily,fontSize:'32dp',fontWeight:'bold'},color:fontcolour,textAlign:'left',left:'10dp',width:'300dp',height:'100%'});tableSectionView.add(tableSectionLabel),section[sectionVal]=Ti.UI.createTableViewSection({headerView:tableSectionView});var tableRowValues;'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?(tableRowValues=db.execute('SELECT * FROM MiscueSession M, Learner L WHERE M.userId = ? AND M.createdDate = ? AND  M.sessionStatus != ? AND M.learnerGuid = L.learnerGuid  AND L.learnerName LIKE \'%'+searchTextFieldValue+'%\'',userId,rowData.fieldByName('createdDate'),'DELETED'),tableSectionLabel.text=tableRowValues.fieldByName('createdDate')):(tableSectionLabel.text=rowData.fieldByName('createdDate'),tableRowValues=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND createdDate = ? AND  sessionStatus != ?',userId,rowData.fieldByName('createdDate'),'DELETED'));for(var x=0;x<tableRowValues.rowCount;x++){audioFileName=tableRowValues.fieldByName('recordedAudioFilename');var sessionGuid=tableRowValues.fieldByName('sessionGuid'),learnerGuid=tableRowValues.fieldByName('learnerGuid'),bookGuid=tableRowValues.fieldByName('bookGUID'),note_Value=tableRowValues.fieldByName('sessionNotes'),createddate=tableRowValues.fieldByName('sessiondate'),editeddate=tableRowValues.fieldByName('lastModifiedDate'),createdSessionTime=tableRowValues.fieldByName('createdTime'),miscueAccuracy=tableRowValues.fieldByName('accuracyValue'),lastServerDate=tableRowValues.fieldByName('lastSavedToServerDate'),searchBookLearnerRow=db.execute('SELECT * FROM UserBook  U, learner  L WHERE U.bookGuid = ? AND L.learnerGuid = ? AND U.userId = ? AND U.userId = L.userId',bookGuid,learnerGuid,userId),groupGuid=searchBookLearnerRow.fieldByName('groupGuid'),learnerimage=searchBookLearnerRow.fieldByName('learnerImage'),learnerName=searchBookLearnerRow.fieldByName('learnerName'),bookimage=searchBookLearnerRow.fieldByName('bookImage'),bookName=searchBookLearnerRow.fieldByName('bookName'),searchGroupRow=db.execute('SELECT groupName FROM LearnerGroup WHERE groupGuid = ? AND loginUserId = ?',groupGuid,userId),groupname=searchGroupRow.fieldByName('groupName');'android'!=Ti.Platform.osname&&(note_Value=note_Value.replace(/\n/gi,'  '));var row=Ti.UI.createTableViewRow({className:'row',height:row_height,backgroundColor:'transparent',backgroundSelectedColor:'transparent',objName:'row',touchEnabled:!0,id:sessionGuid});'android'!=osname&&(row.selectionStyle=Titanium.UI.iPhone.TableViewCellSelectionStyle.NONE);var rowContainerView=Ti.UI.createView({backgroundColor:'transparent',objName:'rowContainerView',id:sessionGuid,touchEnabled:!0,width:Ti.UI.FILL,height:'100%'}),firstRowView=Ti.UI.createView({backgroundColor:'transparent',top:'2dp',left:'5dp',touchEnabled:!1,width:'35%',height:'150dp'}),secondRowContainerView=Ti.UI.createView({backgroundColor:'transparent',top:'2dp',left:'35%',touchEnabled:!1,width:'35%',height:'150dp'}),thirdRowContainerView=Ti.UI.createView({backgroundColor:'transparent',top:'2dp',left:'70%',touchEnabled:!1,width:'20%',height:'150dp'}),fourthRowContainerView=Ti.UI.createView({backgroundColor:'transparent',top:'2dp',left:'90%',touchEnabled:!0,width:'10%',height:'150dp'}),learnerImageView=Ti.UI.createView({backgroundColor:'transparent',top:'33dp',left:'5dp',height:imgDimensions,touchEnabled:!1,width:top[6]});Ti.API.info('learner images '+learnerimage);var learnerImage=Ti.UI.createImageView({defaultImage:'/images/phase5/NOIMAGE.png',top:'0dp',touchEnabled:!1,left:'5dp',height:'100%',width:'auto',image:learnerimage}),createdTime=Ti.UI.createLabel({text:createdSessionTime,left:'110dp',touchEnabled:!1,height:'25dp',width:marginViewWidth,top:'110dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'14dp',fontWeight:'bold'}}),bookImageView=Ti.UI.createView({backgroundColor:'transparent',top:'33dp',left:'1%',touchEnabled:!1,height:imgDimensions,width:top[6]});Ti.API.info('book image '+bookimage);var bookImage=Ti.UI.createImageView({defaultImage:'/images/phase5/NOBOOKIMAGE.png',touchEnabled:!1,top:'0dp',left:'5dp',height:'100%',width:'auto',image:bookimage}),accuracyView=Ti.UI.createView({width:'100%',height:'30dp',touchEnabled:!1}),accuracy=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:miscueAccuracy+'%',height:Titanium.UI.SIZE,width:'80dp',left:'10%',textAlign:Titanium.UI.TEXT_ALIGNMENT_RIGHT,color:fontcolour,touchEnabled:!1,font:{fontFamily:pagefontfamily,fontSize:'18dp',fontWeight:'bold'}})),statusImage=Ti.UI.createImageView({touchEnabled:!1,left:'20%',height:'33dp',width:'33dp',backgroundColor:'transparent'});'null'==lastServerDate||lastServerDate<editeddate?statusImage.image='/images/phase5/NOTSAVEDONSERVER.png':('null'!=lastServerDate||lastServerDate>editeddate)&&(statusImage.image='/images/phase5/SAVEDONSERVER.png');var learnernamelabel=learnerName.replace('&quot;','\''),learnerLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:learnernamelabel,left:'110dp',touchEnabled:!1,height:'25dp',width:marginViewWidth,top:'33dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'18dp',fontWeight:'bold'}})),groupnamelabel=groupname.replace('&quot;','\''),groupLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:groupnamelabel,left:'110dp',touchEnabled:!1,height:'25dp',width:marginViewWidth,top:'70dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'18dp',fontWeight:'bold'}})),bookNameLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:bookName,left:'110dp',touchEnabled:!1,height:'65dp',width:'50%',top:'40dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'18dp',fontWeight:'bold'}}));30<bookNameLabel.text.length&&(bookNameLabel.text=bookNameLabel.text.substr(0,27)+'...'),15<learnerLabel.text.length&&(learnerLabel.text=learnerLabel.text.substr(0,14)+'...'),15<groupLabel.text.length&&(groupLabel.text=learnerLabel.text.substr(0,14)+'...');var noteLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:note_Value,left:'16dp',height:'25dp',visible:!0,touchEnabled:!1,width:'95%',top:noteLabelTop,wordWrap:!1,ellipsize:!0,color:fontcolour,font:{fontFamily:pagefontfamily,fontSize:'15dp',fontWeight:'bold'}})),deleteMainView=Ti.UI.createView({visible:!1,opacity:0.7,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,backgroundColor:'transparent',touchEnabled:!0,height:'94%',width:'100%',objName:'deleteView'}),deleteView=Ti.UI.createView({height:'100%',visible:!0,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,backgroundColor:backcolour,touchEnabled:!1,height:'100%',width:'100%',objName:'deleteView'}),deleteButton=Ti.UI.createLabel({objName:'delete',id:sessionGuid,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,visible:!0,right:'8%',touchEnabled:!0,text:deleteLabelName,height:'35%',width:'30%',textAlign:'center',borderWidth:4,font:{fontSize:'21dp',fontWeight:'bold'},borderColor:'white',color:'black',backgroundColor:'red'}),archiveButton=Ti.UI.createLabel({objName:'archive',id:sessionGuid,visible:!0,right:'40%',touchEnabled:!0,text:'Archive',height:'35%',width:'30%',textAlign:'center',borderWidth:4,font:{fontSize:'21dp',fontWeight:'bold'},borderColor:'white',color:'black',backgroundColor:'red'}),separatorLine=Ti.UI.createView({bottom:'1%',backgroundColor:'#A9A9A9',height:'1dp',width:'100%',touchEnabled:!1});learnerImageView.add(learnerImage),firstRowView.add(groupLabel),firstRowView.add(createdTime),firstRowView.add(learnerImageView),firstRowView.add(learnerLabel),bookImageView.add(bookImage),rowContainerView.add(firstRowView),secondRowContainerView.add(bookImageView),secondRowContainerView.add(bookNameLabel),rowContainerView.add(secondRowContainerView),rowContainerView.add(thirdRowContainerView),accuracyView.add(accuracy),fourthRowContainerView.add(statusImage),rowContainerView.add(fourthRowContainerView),rowContainerView.add(noteLabel),deleteMainView.add(deleteView),'/images/phase5/SAVEDONSERVER.png'==statusImage.image&&deleteMainView.add(archiveButton),deleteMainView.add(deleteButton),rowContainerView.add(deleteMainView),x!=tableRowValues.rowCount-1&&rowContainerView.add(separatorLine),row.add(rowContainerView),deleteMainView.addEventListener('click',function(e){'deleteView'!=e.source.objName||'NOT-DEFINED'!=currentVisibleDeleteView&&(currentVisibleDeleteView.visible=!1,currentVisibleDeleteView='NOT-DEFINED')}),section[sectionVal].add(row),deleteButton.addEventListener('click',function(e){sessionguid=e.source.id;var db=Titanium.Database.open('Miscue'),audioFileExistCheckRow=db.execute('SELECT * FROM MiscueSession  WHERE userId = ? AND sessionGuid = ?',userId,sessionguid),fileName=audioFileExistCheckRow.fieldByName('recordedAudioFilename');audioFileExistCheckRow.close();var deleteSessionCheckRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND sessionGuid=? AND (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,sessionguid,'null');if(0>=deleteSessionCheckRow.rowCount){db.execute('DELETE FROM MiscueSessionItem WHERE miscueSessionId=?',sessionguid),Ti.API.info('deleting '+sessionguid),db.execute('UPDATE MiscueSession SET sessionStatus = ?, lastModifiedDate = ? WHERE sessionGuid = ? AND userId = ?','DELETED',r_sessionBookPage.createDate(),sessionguid,userId),db.close(),Ti.Network.online&&r_HomeScreen.createSaveMiscueSessionToServer(userId,sessionguid,token,'','',fileName);var labelArray=[];labelArray.message=['search_Session_Deleted_Toast','Deleted'],r_HomeScreen.createLocalizedShowToastMessage(labelArray.message,userName),6==miscueSearchWin.children.length&&miscueSearchWin.remove(tableView),'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextFieldValue):createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily)}else 0<deleteSessionCheckRow.rowCount&&(db.close(),dialog.show())}),archiveButton.addEventListener('click',function(e){sessionguid=e.source.id,archiveDialog.show()}),tableRowValues.next()}return tableRowValues.close(),tableRowValues=null,section[sectionVal]}function createCustomeTableViewRowForSmallScreen(rowData,userId,sectionVal){var row_height,bookImageViewleft,dateLabelLeft,noteLabelTop,date_left,learnerLabelTop;row_height='135dp',bookImageViewleft='80dp',dateLabelLeft='145dp',learnerLabelTop='85dp',noteLabelTop='110dp',date_left='190dp';var tableSectionView=Ti.UI.createView({backgroundColor:'white',height:'55dp'}),tableSctionLabel=Ti.UI.createLabel({font:{fontFamily:pagefontfamily,fontSize:'25dp',fontWeight:'bold'},color:'#222',textAlign:'left',left:'10dp',width:'300dp',height:'100%'});tableSectionView.add(tableSctionLabel),section[sectionVal]=Ti.UI.createTableViewSection({headerView:tableSectionView});var tableRowValues;'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?(tableRowValues=db.execute('SELECT * FROM MiscueSession M, Learner L WHERE M.userId = ? AND M.createdDate = ? AND  M.sessionStatus != ? AND M.learnerGuid = L.learnerGuid  AND L.learnerName LIKE \'%'+searchTextFieldValue+'%\'',userId,rowData.fieldByName('createdDate'),'DELETED'),tableSctionLabel.text=tableRowValues.fieldByName('createdDate')):(tableSctionLabel.text=rowData.fieldByName('createdDate'),tableRowValues=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND createdDate = ? AND  sessionStatus != ?',userId,rowData.fieldByName('createdDate'),'DELETED'));for(var x=0;x<tableRowValues.rowCount;x++){audioFileName=tableRowValues.fieldByName('recordedAudioFilename');var sessionGuid=tableRowValues.fieldByName('sessionGuid'),learnerGuid=tableRowValues.fieldByName('learnerGuid'),bookGuid=tableRowValues.fieldByName('bookGUID'),note_Value=tableRowValues.fieldByName('sessionNotes'),createddate=tableRowValues.fieldByName('sessiondate'),editeddate=tableRowValues.fieldByName('lastModifiedDate'),miscueAccuracy=tableRowValues.fieldByName('accuracyValue'),createdSessionTime=tableRowValues.fieldByName('createdTime'),lastServerDate=tableRowValues.fieldByName('lastSavedToServerDate'),searchBookLearnerRow=db.execute('SELECT * FROM UserBook  U, learner  L WHERE U.bookGuid = ? AND L.learnerGuid = ? AND U.userId = ?',bookGuid,learnerGuid,userId),groupGuid=searchBookLearnerRow.fieldByName('groupGuid'),learnerimage=searchBookLearnerRow.fieldByName('learnerImage'),learnerName=searchBookLearnerRow.fieldByName('learnerName'),bookName=searchBookLearnerRow.fieldByName('bookName'),bookimage=searchBookLearnerRow.fieldByName('bookImage'),searchGroupRow=db.execute('SELECT groupName FROM LearnerGroup WHERE groupGuid = ? AND loginUserId = ?',groupGuid,userId),groupname=searchGroupRow.fieldByName('groupName');'android'!=Ti.Platform.osname&&(note_Value=note_Value.replace(/\n/gi,''));var row=Ti.UI.createTableViewRow(r_miscue.tt.combine(r_styles.$$.TableViewRow,{height:row_height,backgroundColor:'transparent',backgroundSelectedColor:'transparent',objName:'row',touchEnabled:!0,id:sessionGuid}));'android'!=osname&&(row.selectionStyle=Titanium.UI.iPhone.TableViewCellSelectionStyle.NONE);var rowContainerView=Ti.UI.createView({backgroundColor:'transparent',objName:'rowContainerView',id:sessionGuid,touchEnabled:!0,width:Ti.UI.FILL,height:'100%',visible:!0,no:x}),groupnamelabel=groupname.replace('&quot;','\''),groupLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:groupnamelabel,left:'85dp',touchEnabled:!1,height:'25dp',width:lWidth/2,top:'40dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'14dp',fontWeight:'bold'}})),learnernamelabel=learnerName.replace('&quot;','\''),learnerLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:learnernamelabel,left:'16dp',touchEnabled:!1,height:'25dp',width:'70%',top:'3dp',color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'18dp',fontWeight:'bold'}}));15<groupLabel.text.length&&(groupLabel.text=learnerLabel.text.substr(0,14)+'...');var bookNameLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:bookName,left:'16dp',touchEnabled:!1,height:'30dp',width:'70%',top:learnerLabelTop,color:fontcolour,visible:!0,font:{fontFamily:pagefontfamily,fontSize:'14dp',fontWeight:'bold'}}));30<bookNameLabel.text.length&&(bookNameLabel.text=bookNameLabel.text.substr(0,27)+'...'),28<learnerLabel.text.length&&(learnerLabel.text=learnerLabel.text.substr(0,14)+'...');var learnerImageView=Ti.UI.createView({backgroundColor:'transparent',top:'33dp',left:'16dp',height:imgDimensions,touchEnabled:!1,width:top[6]}),learnerImage=Ti.UI.createImageView({defaultImage:'/images/phase5/NOIMAGE.png',top:'0dp',touchEnabled:!1,left:'5dp',height:'auto',width:'auto',image:learnerimage}),bookImageView=Ti.UI.createView({backgroundColor:'transparent',top:'33dp',left:'170dp',touchEnabled:!1,height:imgDimensions,width:top[6]});Ti.API.info('book image '+bookimage);var bookImage=Ti.UI.createImageView({defaultImage:'/images/phase5/NOBOOKIMAGE.png',touchEnabled:!1,top:'0dp',height:'auto',width:'auto',image:bookimage}),CreatedTimeLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:createdSessionTime,visible:!0,width:'60dp',height:'25dp',top:'40dp',right:'4dp',color:fontcolour,touchEnabled:!1,font:{fontFamily:pagefontfamily,fontSize:'10dp',fontWeight:'bold'}})),accuracy=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:miscueAccuracy+'%',right:'4dp',visible:!0,textAlign:Titanium.UI.TEXT_ALIGNMENT_RIGHT,color:fontcolour,touchEnabled:!1,right:'4dp',top:'5dp',width:'60dp',height:'25dp',font:{fontFamily:pagefontfamily,fontSize:'15dp',fontWeight:'bold'}})),sessionStatusLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{visible:!0,height:'25dp',right:maxInches>=InchValue?'15dp':'0dp',top:'3dp',color:fontcolour,touchEnabled:!1,font:{fontFamily:pagefontfamily,fontSize:'16dp',fontWeight:'bold'}})),statusImage=Ti.UI.createImageView({touchEnabled:!1,top:'75dp',right:'14dp',height:'28dp',width:'30dp',backgroundColor:'transparent'});'null'==lastServerDate||lastServerDate<editeddate?statusImage.image='/images/phase5/NOTSAVEDONSERVER.png':('null'!=lastServerDate||lastServerDate>editeddate)&&(statusImage.image='/images/phase5/SAVEDONSERVER.png');var noteLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:note_Value,left:'16dp',height:'25dp',visible:!0,touchEnabled:!1,width:'95%',top:noteLabelTop,wordWrap:!1,ellipsize:!0,color:fontcolour,font:{fontFamily:pagefontfamily,fontSize:'15dp',fontWeight:'bold'}})),deleteMainView=Ti.UI.createView({height:'100%',visible:!1,opacity:0.7,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,backgroundColor:backcolour,touchEnabled:!0,height:'94%',width:'100%',objName:'deleteView'}),deleteView=Ti.UI.createView({height:'100%',verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,backgroundColor:backcolour,touchEnabled:!0,height:'100%',width:'100%',objName:'deleteView'}),deleteButton=Ti.UI.createLabel({objName:'delete',id:sessionGuid,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,visible:!0,right:'25dp',touchEnabled:!0,text:deleteLabelName,height:'35%',width:'30%',textAlign:'center',borderWidth:2,borderRadius:10,font:{fontSize:'21dp',fontWeight:'bold'},borderColor:'white',color:'black',backgroundColor:'red'}),archiveButton=Ti.UI.createLabel({objName:'archive',id:sessionGuid,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,visible:!0,right:'145dp',touchEnabled:!0,text:'Archive',height:'35%',width:'30%',textAlign:'center',borderWidth:2,borderRadius:10,font:{fontSize:'21dp',fontWeight:'bold'},borderColor:'white',color:'black',backgroundColor:'red'}),separatorLine=Ti.UI.createView({bottom:'1%',backgroundColor:'#A9A9A9',height:'1dp',width:'100%',touchEnabled:!1});learnerImageView.add(learnerImage),bookImageView.add(bookImage),rowContainerView.add(noteLabel),rowContainerView.add(learnerLabel),rowContainerView.add(CreatedTimeLabel),rowContainerView.add(groupLabel),rowContainerView.add(bookNameLabel),rowContainerView.add(learnerImageView),rowContainerView.add(bookImageView),rowContainerView.add(statusImage),deleteMainView.add(deleteView),deleteMainView.add(deleteButton),'/images/phase5/SAVEDONSERVER.png'==statusImage.image&&deleteMainView.add(archiveButton),rowContainerView.add(deleteMainView),rowContainerView.add(separatorLine),row.add(rowContainerView),deleteMainView.addEventListener('click',function(e){'deleteView'!=e.source.objName||'NOT-DEFINED'!=currentVisibleDeleteView&&(currentVisibleDeleteView.visible=!1,currentVisibleDeleteView='NOT-DEFINED')}),deleteButton.addEventListener('click',function(e){sessionguid=e.source.id;var db=Titanium.Database.open('Miscue'),audioFileExistCheckRow=db.execute('SELECT * FROM MiscueSession  WHERE userId = ? AND sessionGuid = ?',userId,sessionguid),fileName=audioFileExistCheckRow.fieldByName('recordedAudioFilename');audioFileExistCheckRow.close();var deleteSessionCheckRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND sessionGuid=? AND (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,sessionguid,'null');if(0>=deleteSessionCheckRow.rowCount){db.execute('DELETE FROM MiscueSessionItem WHERE miscueSessionId=?',sessionguid),db.execute('UPDATE MiscueSession SET sessionStatus = ?, lastModifiedDate = ? WHERE sessionGuid = ? AND userId = ?','DELETED',r_sessionBookPage.createDate(),sessionguid,userId),db.close(),Ti.Network.online&&r_HomeScreen.createSaveMiscueSessionToServer(userId,sessionguid,token,'','',fileName);var labelArray=[];labelArray.message=['search_Session_Deleted_Toast','Deleted'],r_HomeScreen.createLocalizedShowToastMessage(labelArray.message,userName),6==miscueSearchWin.children.length&&miscueSearchWin.remove(tableView),'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextFieldValue):createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily)}else 0<deleteSessionCheckRow.rowCount&&(db.close(),dialog.show())}),archiveButton.addEventListener('click',function(e){sessionguid=e.source.id,archiveDialog.show()}),section[sectionVal].add(row),tableRowValues.next()}return section[sectionVal]}var audioFileName;miscueSearchWin.add(tableView);for(var accuracy,imgDimensions=top[4],i=0;i<searchMiscueSessionRow.rowCount;i++){if(Inch>=InchValue||'ipad'==osname){var tableViewRow=createCustomeTableViewRowForBiggerScreen(searchMiscueSessionRow,userId,i);searchMiscueSessionRow.next()}else{var tableViewRow=createCustomeTableViewRowForSmallScreen(searchMiscueSessionRow,userId,i);searchMiscueSessionRow.next()}tableviewData.push(tableViewRow)}tableView.setData(section),db.close(),dialog.addEventListener('click',function(e){if(0==e.index){var db=Titanium.Database.open('Miscue'),audioFileExistCheckRow=db.execute('SELECT * FROM MiscueSession  WHERE userId = ? AND sessionGuid = ?',userId,sessionguid),fileName=audioFileExistCheckRow.fieldByName('recordedAudioFilename');audioFileExistCheckRow.close(),db.execute('DELETE FROM MiscueSessionItem WHERE miscueSessionId=?',sessionguid),db.execute('UPDATE MiscueSession SET sessionStatus = ?, lastModifiedDate = ? WHERE sessionGuid = ? AND userId = ?','DELETED',r_sessionBookPage.createDate(),sessionguid,userId),db.close(),Ti.Network.online&&r_HomeScreen.createSaveMiscueSessionToServer(userId,sessionguid,token,'','',fileName);var labelDeleteArray=[];labelDeleteArray.message=['search_Session_Deleted_Toast','Deleted'],r_HomeScreen.createLocalizedShowToastMessage(labelDeleteArray.message,userName),6==miscueSearchWin.children.length&&miscueSearchWin.remove(tableView),'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextFieldValue):createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily)}}),archiveDialog.addEventListener('click',function(e){if(0==e.index){var db=Titanium.Database.open('Miscue'),audioFileExistCheckRow=db.execute('SELECT * FROM MiscueSession  WHERE userId = ? AND sessionGuid = ?',userId,sessionguid),fileName=audioFileExistCheckRow.fieldByName('recordedAudioFilename');if(audioFileExistCheckRow.close(),'null'!=fileName)if('android'!=Ti.Platform.osname){var audioFileName=Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,fileName);audioFileName.deleteFile()}else{var audioDir=Titanium.Filesystem.getFile(Titanium.Filesystem.externalStorageDirectory,'Miscue'),audioFileName=Ti.Filesystem.getFile(audioDir.resolve(),fileName);audioFileName.deleteFile()}var deleteSessionCheckRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND sessionGuid=? AND (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,sessionguid,'null');db.execute('DELETE FROM MiscueSessionItem WHERE miscueSessionId=?',sessionguid),0>=deleteSessionCheckRow.rowCount?db.execute('UPDATE MiscueSession SET sessionStatus = ? WHERE sessionGuid = ? AND userId = ?','DELETED',sessionguid,userId):db.execute('DELETE FROM MiscueSession WHERE sessionGuid=?',sessionguid),deleteSessionCheckRow.close(),db.close(),6==miscueSearchWin.children.length&&miscueSearchWin.remove(tableView),'true'==Ti.App.Properties.getString('isSearchImageButtonIsClicked')?createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily,searchTextFieldValue):createSearchFeild(tableView,userId,miscueSearchWin,userName,token,menuItemKey,fontcolour,backcolour,pagefontfamily)}}),tableView.addEventListener('swipe',function(e){var cnt=e.index;'left'==e.direction&&('row'==e.source.objName?('NOT-DEFINED'!=currentVisibleDeleteView&&(currentVisibleDeleteView.visible=!1),Inch>=InchValue||'ipad'==osname||'iphone'==osname?(e.source.children[0].children[5].visible=!0,currentVisibleDeleteView=e.source.children[0].children[5]):14==e.source.children[0].children.length?(e.source.children[0].children[12].visible=!0,currentVisibleDeleteView=e.source.children[0].children[12]):(e.source.children[0].children[9].visible=!0,currentVisibleDeleteView=e.source.children[0].children[9])):e.source&&'table'!==e.source.objName&&'delete'!==e.source.objName&&'deleteView'!==e.source.objName&&'row'!==e.source.objName&&''!=e.source.objName&&void 0!=e.source.objName&&null!=e.source.objName&&' '!=e.source.objName&&('NOT-DEFINED'!=currentVisibleDeleteView&&(currentVisibleDeleteView.visible=!1),Inch>=InchValue||'ipad'==osname?(e.source.children[5].visible=!0,currentVisibleDeleteView=e.source.children[5]):14==e.source.children.length?(e.source.children[12].visible=!0,currentVisibleDeleteView=e.source.children[12]):(e.source.children[9].visible=!0,currentVisibleDeleteView=e.source.children[9])))})}else section=[],tableView.setData(section);var clickCount=0,swiped='none';tableView.addEventListener('singletap',function(e){if(Ti.API.info('SearchPage'+e.source.objName),'image'==e.source.objName);else{if('table'!=e.source.objName&&'rowContainerView'!=e.source.objName)return;if(1==currentVisibleDeleteView.visible)currentVisibleDeleteView.visible=!1,currentVisibleDeleteView='NOT-DEFINED';else if('table'!=e.source.objName)if('NOT-DEFINED'!=currentVisibleDeleteView)currentVisibleDeleteView.visible=!1,currentVisibleDeleteView='NOT-DEFINED';else{var isSessionBookPage='search';if(clickCount++,1==clickCount){var sessionGuid=e.source.id,db=Titanium.Database.open('Miscue'),searchSessionRowClick=db.execute('SELECT * FROM MiscueSession WHERE sessionGuid=? AND userId = ?',sessionGuid,userId),bookguid=searchSessionRowClick.fieldByName('bookGUID');db.close();var sessionWindow=r_miscue.tt.ui.createSessionWindow(userName,sessionGuid,userId,token,bookguid,isSessionBookPage,menuItemKey);sessionWindow.open(),miscueSearchWin.close()}}}})}exports.createSearchFeild=createSearchFeild;function createSubmitPendingSessionToServer(userId,token,miscueSearchWin,userName,menuItemKey,fontcolour,backcolour,pagefontfamily,isPageName,tableView,submitSession){var saveMiscue,cnt=0,flag=5,sessionGUID=[],sessionDate=[],miscuesessionDate=[],learnerGUID=[],bookGUID=[],miscues=[],session_Id=[],notes=[],modalId=[],sessionStatus=[],flag=5,db=Titanium.Database.open('Miscue'),loginUserNameRow=db.execute('SELECT * FROM Login WHERE userid = ?',userId),loginUserName=loginUserNameRow.fieldByName('username');loginUserNameRow.close();var base_URL='https://www.miscue.co.uk/iglooapi/apirequest.aspx',miscueSaveSessionToServerRow=db.execute('SELECT * FROM MiscueSession WHERE userId = ? AND  (lastSavedToServerDate < lastModifiedDate OR lastSavedToServerDate = ?)',userId,'null'),rowCount=miscueSaveSessionToServerRow.rowCount;if(0<rowCount){for(;miscueSaveSessionToServerRow.isValidRow();){sessionStatus[cnt]=miscueSaveSessionToServerRow.fieldByName('sessionStatus'),sessionGUID[cnt]=miscueSaveSessionToServerRow.fieldByName('sessionGuid'),db.execute('UPDATE MiscueSession SET isLastEditedSession = ? WHERE userId = ?','false',userId),db.execute('UPDATE MiscueSession SET isSessionModified = ?,isLastEditedSession = ?,lastModifiedDate = ? WHERE sessionGuid = ? AND userId = ?','false','true',r_sessionBookPage.createDate(),sessionGUID[cnt],userId);var audioFileExistCheckRow=db.execute('SELECT * FROM MiscueSession  WHERE userId = ? AND sessionGuid = ?',userId,sessionGUID[cnt]),fileName=audioFileExistCheckRow.fieldByName('recordedAudioFilename');'DRAFT'==sessionStatus[cnt]&&(sessionStatus[cnt]='CREATED'),sessionDate[cnt]=miscueSaveSessionToServerRow.fieldByName('sessiondate'),learnerGUID[cnt]=miscueSaveSessionToServerRow.fieldByName('learnerGuid'),bookGUID[cnt]=miscueSaveSessionToServerRow.fieldByName('bookGUID'),notes[cnt]=miscueSaveSessionToServerRow.fieldByName('sessionNotes'),notes[cnt]=notes[cnt].replace(/&/gi,'&amp;'),notes[cnt]=notes[cnt].replace(/</gi,'&lt;'),notes[cnt]=notes[cnt].replace(/>/gi,'&gt;'),notes[cnt]=notes[cnt].replace(/"/gi,'&quot;'),miscues[cnt]=r_HomeScreen.createMiscueXmlData(sessionGUID[cnt],userId),cnt++,miscueSaveSessionToServerRow.next()}audioFileExistCheckRow.close(),db.close();for(var loopEnds='false',x=0;x<rowCount;x++)x==rowCount-1&&(loopEnds='true'),saveMiscueXML='<request><requesttype>SAVEMISCUE</requesttype><status>'+sessionStatus[x]+'</status><accesstoken>'+token+'</accesstoken><sessionGUID>'+sessionGUID[x]+'</sessionGUID><sessionDate>'+sessionDate[x]+'</sessionDate><learnerGUID>'+learnerGUID[x]+'</learnerGUID><bookGUID>'+bookGUID[x]+'</bookGUID><notes>'+notes[x]+'</notes><miscues>'+miscues[x]+'</miscues> </request>',r_Apifile.createApi(base_URL,saveMiscueXML,loginUserName,userId,flag,miscueSearchWin,x+1,sessionGUID[x],token,menuItemKey,fontcolour,backcolour,pagefontfamily,isPageName,tableView,rowCount,fileName,loopEnds,submitSession)}}exports.createSubmitPendingSessionToServer=createSubmitPendingSessionToServer;