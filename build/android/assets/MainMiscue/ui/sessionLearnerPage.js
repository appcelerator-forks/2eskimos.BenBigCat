var r_Apifile=require('/MainMiscue/ui/Apifile'),r_miscue=require('/MainMiscue/miscue.js'),r_loadingScreen=require('/MainMiscue/ui/loadingScreen'),r_styles=require('/MainMiscue/ui/styles');(function(){r_miscue.tt.ui.createLearnerWindow=function(usrname,groupname,token,button_Id,user_Id,menuItemKey){function orientionChangeMode(e){return;var screenRes=r_loadingScreen.backgroundImageHeightWidthPxToDp();screenBackgroundImage[1].width=screenRes[0],Ti.Platform.displayCaps.platformWidth>Ti.Platform.displayCaps.platformHeight?(Inch>=InchValue||'ipad'==osname)&&(screenBackgroundImage[1].height=screenRes[1],Ti.API.info('or change landscape'+screenBackgroundImage[1].height),backView.height=70,backView.width=135):('ipad'==osname||'iphone'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight-Titanium.Platform.displayCaps.platformHeight/2.5,Ti.API.info('or change portrair ipad and iPhone'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),Ti.API.info('or change portrair android'+screenBackgroundImage[1].height)),Inch>=InchValue&&('iphone'==osname||'ipad'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight,Ti.API.info('or change inch > value portrair iphone or ipad'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/100),Ti.API.info('or change inch > value portrair android'+screenBackgroundImage[1].height)),backView.height=80,backView.width=145));var portraitval=r_loadingScreen.dptopixel()}function tableViewClickEvent(e){Ti.API.log('Learner X1 sessionLearnerPage.js called','Learner X1 sessionLearnerPage.js called');var rowid=e.rowData.id;clickCount++;var db=Titanium.Database.open('Miscue'),Bookcontentcheckrow=db.execute('SELECT * FROM UserBook WHERE userId = ? AND deleted = ?',user_Id,'no');if(!(1<=Bookcontentcheckrow.rowCount)){db.close();var labelArray=[];labelArray.title=['Alert','Alert'],labelArray.message=['no_Book_Message','There is no Book is assigned for this user'],labelArray[1]=['Ok','Ok'];var dialog=r_HomeScreen.createLocalizedAlertDialog(labelArray,usrname);dialog.show()}else if(db.close(),1==clickCount){var sessionWindow=r_miscue.tt.ui.createBookNameWindow(usrname,rowid,learnername,token,groupname,button_Id,user_Id,menuItemKey);sessionWindow.open(),learnerWind.remove(screenBackgroundImage[0]),screenBackgroundImage[0]=null,learnerWind.close()}tableView.removeEventListener('click',tableViewClickEvent)}var pWidth=Ti.Platform.displayCaps.platformWidth,db=Titanium.Database.open('Miscue'),homerow=db.execute('SELECT * FROM UserSetting where loginId =?',user_Id),schoolnames=homerow.fieldByName('schoolName'),backpage=homerow.fieldByName('backPage'),backcolour=homerow.fieldByName('backgroundColor'),fontcolour=homerow.fieldByName('fontColor'),pagefontfamily=homerow.fieldByName('charFont'),learnerWindowBackgroundImage=homerow.fieldByName('selectionPagebackgroundURL'),dec=Ti.Utils.base64decode(schoolnames),backView=r_loadingScreen.createBackButton(fontcolour,homerow.fieldByName('backImageURL'));homerow.close(),homerow=null,db.close(),db=null;var iOS7=r_loadingScreen.isiOS7Plus(),learnerWind=Ti.UI.createWindow({fullscreen:!0,navBarHidden:!0,title:'Miscue',tabBarHidden:!0,backgroundColor:'white'});7<=iOS7&&(learnerWind.top='20dp');var Inch=r_loadingScreen.screenInch(),screenBackgroundImage=r_loadingScreen.mainBackgroundImage(learnerWindowBackgroundImage),screenRes=r_loadingScreen.backgroundImageHeightWidthPxToDp(),osname=Ti.Platform.osname;Ti.API.info('osname: '+osname),screenBackgroundImage[1].height='iphone'==osname||'ipad'==osname?Titanium.Platform.displayCaps.platformHeight:Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),screenBackgroundImage[1].width=screenRes[0],Ti.Platform.displayCaps.platformWidth>Ti.Platform.displayCaps.platformHeight?(backView.height=70,backView.width=135,screenBackgroundImage[1].height=screenRes[1],Ti.API.info('Initial height for landscape '+screenBackgroundImage[1].height)):('ipad'==osname||'iphone'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight-Titanium.Platform.displayCaps.platformHeight/2.5,Ti.API.info('Initial height for portrait ipad and iPhone '+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/120),Ti.API.info('Initial height for portrait android'+screenBackgroundImage[1].height)),Inch>=InchValue&&('iphone'==osname||'ipad'==osname?(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight,Ti.API.info('Inch Height for iphone or ipad(portrait)'+screenBackgroundImage[1].height)):(screenBackgroundImage[1].height=Titanium.Platform.displayCaps.platformHeight/(Titanium.Platform.displayCaps.dpi/100),Ti.API.info('Inch Height for android(portrait)'+screenBackgroundImage[1].height)),backView.height=80,backView.width=145)),learnerWind.add(screenBackgroundImage[0]),'iphone'==osname&&(backView.height=48,backView.width=78),Inch<InchValue&&'android'==osname?(backView.height=50,backView.width=80,learnerWind.orientationModes=[Titanium.UI.PORTRAIT]):'android'==osname&&(learnerWind.orientationModes=[Titanium.UI.PORTRAIT]),Ti.Gesture.addEventListener('orientationchange',orientionChangeMode);var top=r_loadingScreen.titleLabeltop();learnerWind.addEventListener('close',function(e){Ti.Gesture.removeEventListener('orientationchange',orientionChangeMode)}),backView.addEventListener('click',function(e){tableView.removeEventListener('click',tableViewClickEvent),learnerWind.remove(selectStudentLabel),learnerWind.remove(backView),tableView.removeAllChildren(),learnerWind.remove(tableView),learnerWind.remove(screenBackgroundImage[0]),screenBackgroundImage[0]=null,selectStudentLabel=null,backView=null,tableView=null,iOS7=null;var groupWindow=r_miscue.tt.ui.createGroupWindow(usrname,token,user_Id,button_Id,menuItemKey);groupWindow.open(),learnerWind.close(),learnerWind=null}),'android'==Ti.Platform.osname&&learnerWind.addEventListener('android:back',function(){tableView.removeEventListener('click',tableViewClickEvent),learnerWind.remove(selectStudentLabel),learnerWind.remove(backView),tableView.removeAllChildren(),learnerWind.remove(tableView),learnerWind.remove(screenBackgroundImage[0]),screenBackgroundImage[0]=null,selectStudentLabel=null,backView=null,tableView=null,iOS7=null;var groupWindow=r_miscue.tt.ui.createGroupWindow(usrname,token,user_Id,button_Id,menuItemKey);groupWindow.open(),learnerWind.close(),learnerWind=null});var selectStudentLabel=Ti.UI.createLabel({color:fontcolour,top:'5%',width:'100%',font:{fontSize:Inch>=InchValue?'28dp':'18dp',fontWeight:'bold',fontFamily:pagefontfamily},textAlign:'center',text:groupname,touchEnabled:!1}),tableView=Ti.UI.createTableView(r_miscue.tt.combine(r_styles.$$.TableView,{top:top[2],separatorColor:'transparent',backgroundColor:'transparent',left:'5%',right:'5%'}));learnerWind.add(selectStudentLabel),learnerWind.add(backView),learnerWind.add(tableView);var db=Titanium.Database.open('Miscue'),holddatavar=db.execute('SELECT * FROM Learner T1  WHERE userId = ? AND deleted = ? AND groupGuid = (SELECT groupGuid FROM LearnerGroup T2 WHERE groupName = ? AND loginUserId = ?)',user_Id,'no',groupname,user_Id);if('iphone'==osname||'ipad'==osname){var footerView=Ti.UI.createView({height:0});tableView.footerView=footerView,tableView.footerTitle=''}tvData=[],Ti.API.info('----------BEN - holddatavar.typeof 1 = '+holddatavar),Ti.API.info('----------BEN - holddatavar.rowCount = '+holddatavar.rowCount);for(var i=0;i<holddatavar.rowCount;i++){Ti.API.info('----------BEN Row '+i+' :');for(var j=0;j<holddatavar.fieldCount;j++)Ti.API.info('----------Ben - Row '+i+' Field '+j+' = '+holddatavar.fieldName(j)+' = '+holddatavar.field(j));var learnername=holddatavar.fieldByName('learnerName'),learnernamelabel=learnername.replace('&quot;','\''),learnerimg=holddatavar.fieldByName('learnerImage'),learnerGuID=holddatavar.fieldByName('learnerguid');Ti.API.info('learnername '+learnername),Ti.API.info('learnerimg '+learnerimg),Ti.API.info('learnerGuID '+learnerGuID);var row=Ti.UI.createTableViewRow(r_miscue.tt.combine(r_styles.$$.TableViewRow,{height:top[3],backgroundColor:'transparent',id:learnerGuID})),spacing='8dp',imgDimensions=top[4],thisView=Ti.UI.createView({backgroundColor:'transparent',bottom:'1dp',left:spacing,height:imgDimensions,width:top[6]}),learnerImage=Ti.UI.createImageView({defaultImage:'/images/phase5/NOIMAGE.png',bottom:'1dp',left:'0dp',height:'auto',width:'auto',image:learnerimg}),learnerLabel=Ti.UI.createLabel(r_miscue.tt.combine(r_styles.$$.boldHeaderText,{text:learnernamelabel,left:top[5],color:fontcolour,font:{fontSize:Inch>=InchValue?'28dp':'18dp',fontWeight:'bold',fontFamily:pagefontfamily}})),separatorLine=Ti.UI.createView({bottom:'1%',backgroundColor:'#A9A9A9',height:'3dp',width:'100%'});thisView.add(learnerImage),row.add(learnerLabel),row.add(thisView),row.add(separatorLine),tvData.push(row),holddatavar.next()}db.close(),holddatavar.close(),tableView.setData(tvData);var clickCount;return learnerWind.addEventListener('focus',function(e){clickCount=0}),tableView.addEventListener('click',tableViewClickEvent),learnerWind}})();var r_sessionBookPage=require('/MainMiscue/ui/sessionBookPage');